{% extends "pages/base.html" %}
{% load i18n %}
{% block title %}{{ item.title }}{% endblock %}
{% block content %}
<div class="card p-3">
    {% if item.images.all %}
        <div style="max-height: 400px; overflow-x: auto; white-space: nowrap;">
            {% for image in item.images.all %}
                <img src="{{ image.image.url }}" alt="{{ item.title }}" style="max-height: 400px; max-width: 100%; display: inline-block; margin-right: 10px;">
            {% endfor %}
        </div>
    {% endif %}
    <div class="card-body">
        <h3 class="card-title">
            {{ item.title }}
            {% if item.is_featured %}
                <span class="badge bg-warning text-dark">★ {% trans "Featured" %}</span>
            {% endif %}
        </h3>
        <p class="card-text">{{ item.description }}</p>
        <p><strong>${{ item.price }}</strong></p>
        <p><small>{% trans "Posted on" %} {{ item.seller.username }} | {{ item.created_at|date:"Y-m-d H:i" }}</small></p>

        <a href="/" class="btn btn-secondary">{% trans "Back to list" %}</a>

        {% if user.is_authenticated %}
            <form method="post" action="{% url 'toggle_favorite' item.id %}" class="d-inline">
                {% csrf_token %}
                {% if user in item.favorited_by.all %}
                    <button class="btn btn-warning" type="submit">{% trans "Unfavorite" %} ⭐</button>
                {% else %}
                    <button class="btn btn-outline-warning" type="submit">{% trans "Favorite" %} ⭐</button>
                {% endif %}
            </form>

            {% if user != item.seller %}
                {% if not item.is_sold %}
                    <form method="post" action="{% url 'send_purchase_request' item.id %}">
                        {% csrf_token %}
                        <button class="btn btn-success" type="submit">{% trans "Buy Now" %} 🛒</button>
                    </form>
                {% else %}
                    <span class="text-danger ms-2">{% trans "This item has been sold." %}</span>
                {% endif %}
            {% else %}
                <span class="text-muted ms-2">{% trans "You cannot buy your own item." %}</span>
            {% endif %}
        {% endif %}
    </div>
</div>
{% endblock %}
